(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{2870:(e,t,r)=>{"use strict";r.d(t,{l:()=>n});var o=r(2987);let a=(0,o.iq)(),s=(0,o.MB)(),n={getTodo:a,postTodo:s,patchTodo:(0,o.AW)(),deleteTodo:(0,o.Fb)()}},2987:(e,t,r)=>{"use strict";r.d(t,{AW:()=>v,Fb:()=>h,MB:()=>d,O5:()=>c,iq:()=>u});var o=r(3464),a=r(4747);let s=a.A.BASE_URL_DEV,n=o.A.create({baseURL:s,headers:{"Content-Type":"application/json"},timeout:1e4}),l=null,c=e=>{l=e};function i(e,t){let r={};return"string"==typeof t?r.Authorization="Bearer ".concat(t):"object"==typeof t&&Object.assign(r,t),e instanceof FormData&&r["Content-Type"]&&delete r["Content-Type"],r}function u(){return async(e,t)=>{try{let r={headers:i(void 0,null==t?void 0:t.tokenOrHeaders)};return await n.get(e,r)}catch(e){var r;throw console.error("GET Request Error:",e),(null==(r=e.response)?void 0:r.data)||e}}}function d(){return async(e,t)=>{try{let r={headers:i(null==t?void 0:t.data,null==t?void 0:t.tokenOrHeaders)};return await n.post(e,null==t?void 0:t.data,r)}catch(e){var r;throw console.error("POST Request Error:",e),(null==(r=e.response)?void 0:r.data)||e}}}function v(){return async(e,t)=>{try{let r={headers:i(null==t?void 0:t.data,null==t?void 0:t.tokenOrHeaders)};return await n.patch(e,null==t?void 0:t.data,r)}catch(e){var r;throw console.error("PATCH Request Error:",e),(null==(r=e.response)?void 0:r.data)||e}}}function h(){return async(e,t)=>{try{let r={headers:i(void 0,null==t?void 0:t.tokenOrHeaders)};return await n.delete(e,{...r})}catch(e){var r;throw console.error("DELETE Request Error:",e),(null==(r=e.response)?void 0:r.data)||e}}}n.interceptors.request.use(async e=>{var t;if(!l){let e=localStorage.getItem("userToken");e&&(l=e)}return!l||(null==(t=e.url)?void 0:t.endsWith(a.A.Login))||(e.headers.Authorization="Bearer ".concat(l)),e},e=>Promise.reject(e)),n.interceptors.response.use(e=>e,async e=>{var t,r;return((null==(t=e.response)?void 0:t.status)===401||(null==(r=e.response)?void 0:r.status)===403)&&(console.warn("Unauthorized access. Clearing token and redirecting to login."),localStorage.removeItem("userToken"),localStorage.removeItem("userInfo"),c(null),c(null)),Promise.reject(e)})},3274:(e,t,r)=>{"use strict";r.d(t,{A:()=>d,AuthProvider:()=>u});var o=r(5155),a=r(2115),s=r(5695),n=r(4747),l=r(2987),c=r(2870);let i=(0,a.createContext)(void 0),u=e=>{let{children:t}=e,[r,u]=(0,a.useState)(null),[d,v]=(0,a.useState)(!0),h=(0,s.useRouter)();(0,a.useEffect)(()=>{(()=>{try{let e=localStorage.getItem("userInfo"),t=localStorage.getItem("userToken");if(e&&t){let r=JSON.parse(e);u(r),(0,l.O5)(t)}}catch(e){console.error("Failed to load auth state from storage:",e)}finally{v(!1)}})()},[]);let m=async(e,t)=>{v(!0);try{let r=await c.l.postTodo(n.A.Login,{data:{username:e,password:t}}),o=r.data;if(console.log(o),200!==r.status||!o.accessToken)return{success:!1,error:"Unexpected API response."};{let e=o.accessToken;return localStorage.setItem("userInfo",JSON.stringify(o)),localStorage.setItem("userToken",e),u(o),(0,l.O5)(e),{success:!0,error:null}}}catch(t){var r,o;let e=(null==t||null==(o=t.response)||null==(r=o.data)?void 0:r.message)||(null==t?void 0:t.message)||"Invalid credentials. Please try again.";return console.error("Login error:",t),{success:!1,error:e}}finally{v(!1)}},p=async()=>{v(!0);try{localStorage.removeItem("userInfo"),localStorage.removeItem("userToken"),u(null),(0,l.O5)(null),h.push("/")}catch(e){console.error("Logout error:",e)}finally{v(!1)}};return(0,o.jsx)(i.Provider,{value:{user:r,isLoading:d,login:m,logout:p},children:t})},d=()=>{let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4747:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});class o{}o.BASE_URL_DEV="https://dummyjson.com",o.Login="/auth/login",o.FetchTodo=(e,t)=>"/todos?limit=".concat(e,"&skip=").concat(t),o.FetchTodoByUserID=e=>"/todos/user/".concat(e),o.CreateTodo="/todos/add",o.UpdateTodo=e=>"/todos/".concat(e)},5688:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_5cfdac",variable:"__variable_5cfdac"}},7956:(e,t,r)=>{Promise.resolve().then(r.bind(r,3274)),Promise.resolve().then(r.t.bind(r,5688,23)),Promise.resolve().then(r.t.bind(r,9432,23)),Promise.resolve().then(r.t.bind(r,9324,23))},9324:()=>{},9432:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}}},e=>{e.O(0,[261,794,441,964,358],()=>e(e.s=7956)),_N_E=e.O()}]);