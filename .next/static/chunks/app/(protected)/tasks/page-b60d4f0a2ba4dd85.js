(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[749],{4931:(e,t,a)=>{"use strict";a.d(t,{E:()=>o,X:()=>r});var s=a(9775);let o=s.Ay$.object({todo:s.Ay$.string().min(1,{message:"You must enter a todo item."}),completed:s.Ay$.boolean().default(!1).optional()}),r=s.Ay$.object({username:s.Ay$.string().min(1,{message:"Username is required."}),password:s.Ay$.string().min(1,{message:"Password is required."}),expiresInMins:s.Ay$.number()})},5033:(e,t,a)=>{Promise.resolve().then(a.bind(a,9855))},9540:(e,t,a)=>{"use strict";a.d(t,{lV:()=>d,MJ:()=>p,zB:()=>c,eI:()=>x,C5:()=>g});var s=a(5155),o=a(2115),r=a(9708),n=a(2177),i=a(3999);let d=n.Op,l=o.createContext({}),c=e=>{let{...t}=e;return(0,s.jsx)(l.Provider,{value:{name:t.name},children:(0,s.jsx)(n.xI,{...t})})},u=()=>{let e=o.useContext(l),t=o.useContext(m),{getFieldState:a}=(0,n.xW)(),s=(0,n.lN)({name:e.name}),r=a(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...r}},m=o.createContext({});function x(e){let{className:t,...a}=e,r=o.useId();return(0,s.jsx)(m.Provider,{value:{id:r},children:(0,s.jsx)("div",{"data-slot":"form-item",className:(0,i.cn)("grid gap-2",t),...a})})}function p(e){let{...t}=e,{error:a,formItemId:o,formDescriptionId:n,formMessageId:i}=u();return(0,s.jsx)(r.DX,{"data-slot":"form-control",id:o,"aria-describedby":a?"".concat(n," ").concat(i):"".concat(n),"aria-invalid":!!a,...t})}function g(e){var t;let{className:a,...o}=e,{error:r,formMessageId:n}=u(),d=r?String(null!=(t=null==r?void 0:r.message)?t:""):o.children;return d?(0,s.jsx)("p",{"data-slot":"form-message",id:n,className:(0,i.cn)("text-destructive text-sm",a),...o,children:d}):null}},9852:(e,t,a)=>{"use strict";a.d(t,{p:()=>r});var s=a(5155);a(2115);var o=a(3999);function r(e){let{className:t,type:a,...r}=e;return(0,s.jsx)("input",{type:a,"data-slot":"input",className:(0,o.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...r})}},9855:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>M});var s=a(5155),o=a(7924),r=a(4616),n=a(3717),i=a(2525),d=a(3052),l=a(2252),c=a(9852),u=a(2115),m=a(968),x=a(381),p=a(5196),g=a(3999);function f(e){let{className:t,...a}=e;return(0,s.jsx)(x.bL,{"data-slot":"checkbox",className:(0,g.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:(0,s.jsx)(x.C1,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,s.jsx)(p.A,{className:"size-3.5"})})})}var h=a(7210),b=a(7001),v=a(2870),j=a(4747);let y=e=>{let{addOrUpdateTask:t}=(0,b.U)(),a=async a=>{try{let s=await v.l.patchTodo(j.A.UpdateTodo(e.id),{data:{completed:a}});200===s.status?(console.log("Task updated successfully on API:",s.data),t(s.data)):console.error("TaskList: Error during API call for update. Status: ".concat(s.status),s.data)}catch(e){console.error("TaskList: Error updating task:",e)}};return(0,s.jsx)("div",{className:"flex items-start justify-between border-b border-[#e6e6e6] py-2",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("div",{children:(0,s.jsx)(f,{id:"checkbox-".concat(e.id),checked:e.completed,onCheckedChange:a,className:"mt-1"})}),(0,s.jsxs)("div",{className:"grid",children:[(0,s.jsx)(m.J,{htmlFor:"checkbox-".concat(e.id),className:e.completed?"line-through text-gray-500":"",children:e.todo}),(0,s.jsx)("div",{className:"flex items-center gap-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-1 text-muted-foreground ",children:[(0,s.jsx)(h.A,{size:14}),(0,s.jsx)("p",{className:"text-sm",children:e.completed?"Completed":"Pending"})]})})]})]})},e.id)};var k=a(3274),N=a(5695),w=a(7168),A=a(8083),C=a(4416);function T(e){let{...t}=e;return(0,s.jsx)(A.bL,{"data-slot":"dialog",...t})}function P(e){let{...t}=e;return(0,s.jsx)(A.ZL,{"data-slot":"dialog-portal",...t})}function S(e){let{className:t,...a}=e;return(0,s.jsx)(A.hJ,{"data-slot":"dialog-overlay",className:(0,g.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function I(e){let{className:t,children:a,showCloseButton:o=!0,...r}=e;return(0,s.jsxs)(P,{"data-slot":"dialog-portal",children:[(0,s.jsx)(S,{}),(0,s.jsxs)(A.UC,{"data-slot":"dialog-content",className:(0,g.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...r,children:[a,o&&(0,s.jsxs)(A.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,s.jsx)(C.A,{}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}var F=a(221),z=a(2177),$=a(9540),U=a(4931);function E(e){let{className:t,...a}=e;return(0,s.jsx)("textarea",{"data-slot":"textarea",className:(0,g.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...a})}function L(e){let{initialData:t,onSuccess:a,onCancel:o}=e,{user:r}=(0,k.A)(),{addOrUpdateTask:n}=(0,b.U)(),[i,d]=(0,u.useState)(!1),[l,c]=(0,u.useState)(null),m=!!(null==t?void 0:t.id),x=(0,z.mN)({resolver:(0,F.u)(U.E),defaultValues:{todo:(null==t?void 0:t.todo)||""}});async function p(e){if(d(!0),c(null),!(null==r?void 0:r.id)){c("User not authenticated. Please log in again."),d(!1);return}try{let s;m&&(null==t?void 0:t.id)?(console.log("TaskForm: Sending PATCH request to update todo:",t.id),s=await v.l.patchTodo(j.A.UpdateTodo(t.id),{data:{todo:e.todo,completed:t.completed}})):(console.log("TaskForm: Sending POST request to add new todo."),s=await v.l.postTodo(j.A.CreateTodo,{data:{todo:e.todo,completed:!1,userId:r.id}})),200===s.status||201===s.status?(x.reset(),console.log("TaskForm: API operation successful. Data from API:",s.data),n(s.data),a&&(console.log("TaskForm: Calling onSuccess callback."),a())):(c("Failed to ".concat(m?"update":"add"," task: Unexpected response status ").concat(s.status)),console.error("TaskForm: Unexpected API response status:",s.status,s.data))}catch(t){var s,o;if(console.error("TaskForm: Error during API call for ".concat(m?"update":"add",":"),t),!m&&(null==r?void 0:r.id)){let t={id:Math.floor(1e6*Math.random())+2e4,todo:e.todo,completed:!1,userId:r.id};console.warn("TaskForm: Saving task locally due to API failure:",t),n(t),a&&a()}c((null==t||null==(o=t.response)||null==(s=o.data)?void 0:s.message)||"Failed to ".concat(m?"update":"add"," task. Please try again."))}finally{d(!1)}}return(0,s.jsx)($.lV,{...x,children:(0,s.jsxs)("form",{onSubmit:x.handleSubmit(p),className:"space-y-2",children:[l&&(0,s.jsx)("p",{className:"text-red-500 text-sm text-center",children:l}),(0,s.jsx)("div",{className:"border-b border-[#e6e6e6] py-2",children:(0,s.jsx)($.zB,{control:x.control,name:"todo",render:e=>{let{field:t}=e;return(0,s.jsxs)($.eI,{children:[(0,s.jsx)($.MJ,{children:(0,s.jsx)(E,{className:"border-0 shadow-none font-semibold focus-visible:ring-ring/0 px-0",placeholder:"What's on your todo list today?",...t,disabled:i})}),(0,s.jsx)($.C5,{})]})}})}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[m&&o&&(0,s.jsx)(w.$,{type:"button",variant:"outline",onClick:o,disabled:i,children:"Cancel"}),(0,s.jsx)(w.$,{type:"submit",disabled:i,children:i?"Saving...":m?"Save Changes":"Add Task"})]})]})})}function M(){let{user:e,isLoading:t}=(0,k.A)(),a=(0,N.useRouter)(),{todos:m,syncTodos:x,deleteTask:p}=(0,b.U)(),[g,f]=(0,u.useState)(!0),[h,A]=(0,u.useState)(null),[C,P]=(0,u.useState)(""),[S,F]=(0,u.useState)(1),[z,$]=(0,u.useState)(0),[U,E]=(0,u.useState)(!1),[M,_]=(0,u.useState)(void 0),O=(0,u.useCallback)(async()=>{if(!e)return void f(!1);f(!0),A(null);try{let e=(S-1)*10,t=j.A.FetchTodo(10,e);console.log("TasksPage: Fetching todos from API for page ".concat(S,"."));let a=await v.l.getTodo(t);if(200===a.status&&a.data&&Array.isArray(a.data.todos)){let e=a.data.todos;x(e),$(a.data.total),console.log("TasksPage: Todos fetched and synced successfully.")}else A("Failed to fetch todos: Unexpected response structure."),console.error("TasksPage: Unexpected API response structure:",a)}catch(e){var t,a;console.error("TasksPage: Error fetching todos:",e),A((null==e||null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"Failed to fetch tasks.")}finally{f(!1)}},[e,S,10,x]);(0,u.useEffect)(()=>{if(!t&&!e)return void a.push("/login");e&&O()},[e,t,S,O,a]);let q=(0,u.useMemo)(()=>{if(!C)return m;let e=C.toLowerCase();return m.filter(t=>t.todo.toLowerCase().includes(e))},[m,C]),D=(0,u.useMemo)(()=>Math.ceil(z/10),[z,10]),J=(0,u.useCallback)(()=>{E(!1),_(void 0)},[]);return(0,s.jsxs)("div",{className:"bg-blue-50 min-h-screen relative",children:[(0,s.jsx)(l.Y,{}),(0,s.jsx)(l.p,{}),(0,s.jsxs)("main",{className:"mt-16 px-5 py-5",children:[(0,s.jsxs)("div",{className:"text-lg font-semibold text-center py-2",children:["Hi"," ",(null==e?void 0:e.firstName)&&(null==e?void 0:e.lastName)?"".concat(e.firstName," ").concat(e.lastName):(null==e?void 0:e.username)||"Guest"]}),(0,s.jsxs)("div",{className:"bg-white flex items-center px-3 border border-black mb-4",children:[(0,s.jsx)(o.A,{}),(0,s.jsx)(c.p,{className:"border-0 focus-visible:ring-ring/0",placeholder:"Type your search term here...",value:C,onChange:e=>{P(e.target.value)}})]}),(0,s.jsx)("div",{className:"flex justify-end mb-4",children:(0,s.jsxs)(w.$,{onClick:()=>{_(void 0),E(!0)},variant:"ghost",className:"cursor-pointer",children:[(0,s.jsx)("span",{className:"bg-black p-1 rounded-full text-white",children:(0,s.jsx)(r.A,{})})," ",(0,s.jsx)("span",{className:"capitalize text-[16px]",children:"Add Task"})]})}),(0,s.jsx)("div",{className:"my-5",children:g?(0,s.jsx)("p",{className:"text-center text-gray-600",children:"Loading tasks..."}):h?(0,s.jsx)("p",{className:"text-center text-red-500",children:h}):0!==q.length||g?q.map(e=>(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("div",{className:"w-[80%]",children:(0,s.jsx)(y,{...e})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(w.$,{variant:"ghost",size:"sm",onClick:()=>{_(e),E(!0)},children:(0,s.jsx)(n.A,{className:"h-4 w-4"})}),(0,s.jsx)(w.$,{variant:"ghost",size:"sm",onClick:()=>{window.confirm("Are you sure you want to delete this task?")&&p(e.id)},children:(0,s.jsx)(i.A,{className:"h-4 w-4"})})]})]},e.id)):(0,s.jsx)("p",{className:"text-center text-gray-600",children:C?'No matching tasks found for "'.concat(C,'".'):"No tasks found on this page."})}),D>1&&(0,s.jsxs)("div",{className:"flex justify-center items-center space-x-2 mt-8",children:[(0,s.jsx)(w.$,{onClick:()=>{S>1&&(F(e=>e-1),P(""))},disabled:1===S||g,children:(0,s.jsx)(d.A,{className:"rotate-180"})}),(0,s.jsxs)("span",{className:"text-gray-700",children:["Page ",S," of ",D]}),(0,s.jsx)(w.$,{onClick:()=>{S<D&&(F(e=>e+1),P(""))},disabled:S===D||g,children:(0,s.jsx)(d.A,{})})]})]}),(0,s.jsx)(T,{open:U,onOpenChange:E,children:(0,s.jsx)(I,{className:"sm:max-w-[425px]",children:(0,s.jsx)(L,{initialData:M,onSuccess:J,onCancel:()=>E(!1)})})})]})}}},e=>{e.O(0,[794,455,467,307,22,447,441,964,358],()=>e(e.s=5033)),_N_E=e.O()}]);